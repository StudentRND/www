{% extends "template.twig" %}
{% block section %}admin{% endblock %}
{% block page %}donations{% endblock %}
{% block title %}Donations Admin{% endblock %}
{% block page_tagline %}$$${% endblock %}
{% block content %}
    <section class="tools">
        <h3>Receive Donation</h3>
        <form action="/admin/donations/new" method="post">
            <h4>Info</h4>
            <input type="text" name="first_name" placeholder="First Name" required />
            <input type="text" name="last_name" placeholder="Last Name" required />
            <input type="checkbox" name="is_anonymous" value="1" id="is_anonymous"><label for="is_anonymous">Anon</label>
            <br />
            <input type="email" name="email" placeholder="Email" />
            <br />

            <h4>Address</h4>
            <input type="text" name="address_1" placeholder="Address" /><br />
            <input type="text" name="address_1" placeholder="Address" /><br />
            <input type="text" name="city" placeholder="City" />
            <input type="text" name="state" placeholder="State" />
            <input type="text" name="zip" placeholder="Zip" /><br /><br />


            <h4>$</h4>
            <input type="text" name="amount" placeholder="Amount" pattern="\d+(\.\d\d)?" required />
            <select name="transaction_source">
                <option value="stripe">Stripe</option>
                <option value="dwolla">Dwolla</option>
                <option value="check" selected>Check</option>
                <option value="in-kind">In-Kind</option>
            </select>
            <input type="text" name="transaction_id" placeholder="Trans ID" /><br />

            <textarea name="in_kind_description" placeholder="Description of goods (non-cash only)"></textarea>

            <input type="submit" value="Generate Receipt" />
        </form>
    </section>

    <section class="info">
        <h3>Statistics</h3>
        <table>
            <thead>
                <tr>
                    <th>Period</th>
                    <th>Number of Donations</th>
                    <th>Total Donations</th>
                    <th>Average Donation</th>
                </tr>
            </thead>
            <tbody>
                {% for period,val in stats %}
                    <tr>
                        <td>{{ period }}</td>
                        <td>{{ val.count }}</td>
                        <td>${{ val.total|round(2) }}</td>
                        <td>${{ val.average|round(2) }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>Monthly Donations</h3>
        <ul>
            {% for subscriber in subscribers %}
                <li>
                    <a href="/donate/receipt/{{ subscriber.id }}">{{ subscriber.displayName }}</a> &mdash;
                    ${{ subscriber.amount|round(2) }}/month since {{ subscriber.created_at.timestamp|date('F j Y') }}
                    {% if subscriber.cancelled_at %}
                        &mdash; CANCELLED {{ subscriber.created_at.timestamp|date('F j Y') }}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>

        <h3>All Donations</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Amount</th>
                    <th>Via</th>
                </tr>
            </thead>
            <tbody>
                {% for donation in donations %}
                    <tr>
                        <td><a href="/donate/receipt/{{ donation.id }}">{{ donation.created_at.timestamp|date('m/d/y') }}</a></td>
                        <td>{{ donation.displayName }}</td>
                        <td>${{ donation.amount|round(2) }}{% if donation.transaction_subscription_id %}(rec){% endif %}</td>
                        <td>{{ donation.transaction_source }} &mdash; {{ donation.transaction_id }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
{% endblock %}